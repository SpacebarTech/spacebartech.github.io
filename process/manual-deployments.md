---
layout: default
title: Manual Deployments
category: process
permalink: "/process/manual-deployments"
---

# {{ page.title }}

## Domain management

Create an `A Record` where the address is the target IP
address.

## Server management

Once the `A Record` has been created, `ssh` into the server
that the record points to. Once you're in, `clone` the
project to the server. At this point, we can install all
package dependencies with `npm`, and also run the build
script (if the project has one, like a frontend).

If the build fails for without an error message and an
`ERRNO 137`, you may need to increase the server RAM. Then
restart the build to verify the success.

## Nginx

You can install Nginx with the following:

```sh
apt install nginx
```

Then open the `nginx.conf` in your favorite `vim` companion
and add the `server` block to the configuration.

```conf
# Server config sample coming soon...
```

### Set user permissions

By default, Nginx runs its processes as user `www-data`.
Typically, users can't access other users' root directories
(including those running in Docker, or on rootless servers).
If you find yourself getting a 403 or 404 error, check the
Nginx permissions with

```sh
sudo -u www-data stat path/to/directory
```

If the above command fails, Nginx doesn't have access to
the site. You can give it access by running

```sh
gpasswd -a www-data <owner>
```

If you've had to do the above, restart the server now.

## SSL keys

Generate the SSL certificates with the following:

```sh
certbot certonly --standalone -d <domain_name>
```

Note that ports `80` and `443` _must_ be accessible, and
nothing is allowed to be listening on them. We will
leverage port `8080` at this point for our frontend.

## `reverse-proxy`

Clone the company's `reverse-proxy` if it hasn't already
been cloned. For now, there's not one single directory to
clone the project to, so that will come later in the future.
Make symlinks to the `*.pem` files generated by `certbot`
in the `reverse-proxy/private` directory.

## pm2

Once all the above steps are completed, start the frontend,
`reverse-proxy`, and API with pm2. Give the processes
meaningful names for clarity's sake.
